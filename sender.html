<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pick A Class</title>
    <link rel="shortcut icon" href="redirector.png" type="image/x-icon">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter for a modern look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for transitions and specific elements not covered by Tailwind */
        body {
            font-family: 'Inter', sans-serif;
            /* Base light theme colors */
            background-color: #f3f4f6; /* gray-100 */
            color: #1f2937; /* gray-800 */
            transition: background-color 0.5s ease-in-out, color 0.5s ease-in-out;
        }


        /* Dark Theme overrides */
        body.dark-theme {
            background-color: #0a0a0a; /* gray-950 */
            color: #f9fafb; /* gray-100 */
        }


        .main-container {
            background-color: #ffffff; /* white */
            border-color: #e5e7eb; /* gray-200 */
            transition: background-color 0.5s ease-in-out, border-color 0.5s ease-in-out, box-shadow 0.5s ease-in-out;
        }
        body.dark-theme .main-container {
            background-color: #111827; /* gray-900 */
            border-color: #374151; /* gray-800 */
        }


        h1 {
            color: #dc2626; /* red-600 */
            transition: color 0.5s ease-in-out;
        }
        body.dark-theme h1 {
            color: #ef4444; /* red-500 */
        }


        h3#Time {
            color: #9333ea; /* purple-600 */
            transition: color 0.5s ease-in-out;
        }
        body.dark-theme h3#Time {
            color: #a78bfa; /* purple-400 */
        }


        h2 {
            color: #1f2937; /* gray-800 */
            transition: color 0.5s ease-in-out;
        }
        body.dark-theme h2 {
            color: #f9fafb; /* gray-100 */
        }


        footer {
            color: #6b7280; /* gray-500 */
            transition: color 0.5s ease-in-out;
        }
        body.dark-theme footer {
            color: #9ca3af; /* gray-400 */
        }


        #settings-button {
            background-color: #9333ea; /* purple-600 */
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        body.dark-theme #settings-button {
            background-color: #a78bfa; /* purple-500 */
        }
        #settings-button:hover {
            box-shadow: 0 8px 16px rgba(147, 51, 234, 0.4); /* purple-600 with shadow */
        }
        body.dark-theme #settings-button:hover {
            box-shadow: 0 8px 16px rgba(167, 139, 250, 0.4); /* purple-400 with shadow */
        }


        #theme-toggle {
            background-color: #4b5563; /* gray-700 */
            color: #ffffff; /* white */
            transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        body.dark-theme #theme-toggle {
            background-color: #e5e7eb; /* gray-200 */
            color: #1f2937; /* gray-800 */
        }
        #theme-toggle:hover {
            box-shadow: 0 8px 16px rgba(75, 85, 99, 0.4); /* gray-700 with shadow */
        }
        body.dark-theme #theme-toggle:hover {
            box-shadow: 0 8px 16px rgba(229, 231, 235, 0.4); /* gray-200 with shadow */
        }


        .class-card {
            background-color: #f9fafb; /* gray-50 */
            border-color: #e5e7eb; /* gray-200 */
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, background-color 0.3s ease-in-out, border-color 0.3s ease-in-out;
            cursor: pointer;
            position: relative;
        }
        body.dark-theme .class-card {
            background-color: #1f2937; /* gray-800 */
            border-color: #374151; /* gray-700 */
        }
        .class-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
        body.dark-theme .class-card:hover {
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }


        .class-card h4 {
            color: #ea580c; /* orange-600 */
            transition: color 0.5s ease-in-out;
        }
        body.dark-theme .class-card h4 {
            color: #fbbf24; /* orange-400 */
        }


        .class-card p {
            color: #4b5563; /* gray-600 */
            transition: color 0.5s ease-in-out;
        }
        body.dark-theme .class-card p {
            color: #d1d5db; /* gray-300 */
        }


        .new-tab-button {
            background-color: rgba(129, 140, 248, 0.8); /* indigo-400 */
            color: white; /* Always white */
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out, background-color 0.3s ease-in-out;
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.5rem;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(0.8);
            z-index: 10;
        }
        body.dark-theme .new-tab-button {
            background-color: rgba(59, 130, 246, 0.8); /* blue-500 */
        }
        .class-card:hover .new-tab-button {
            opacity: 1;
            transform: scale(1);
        }


        .schedule-img {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out;
        }
        .schedule-img:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        body.dark-theme .schedule-img:hover {
             box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        }
        
        /* --- Modal Styles --- */
        .modal-content {
            background-color: #ffffff; /* white */
            border-color: #e5e7eb; /* gray-300 */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.3s ease-in-out, border-color 0.3s ease-in-out;
        }
        body.dark-theme .modal-content {
            background-color: #1f2937; /* gray-800 */
            border-color: #374151; /* gray-700 */
        }


        .modal-content h3 {
            color: #1f2937; /* gray-800 */
            transition: color 0.5s ease-in-out;
        }
        body.dark-theme .modal-content h3 {
            color: #f9fafb; /* gray-100 */
        }


        .modal-content button.text-gray-400 { /* Close button */
            color: #9ca3af; /* gray-400 */
            transition: color 0.3s ease-in-out;
        }
        body.dark-theme .modal-content button.text-gray-400 {
            color: #f9fafb; /* white */
        }


        #modal-scrollable-content {
            scrollbar-width: thin;
            scrollbar-color: #4b5563 #374151;
        }
        body.dark-theme #modal-scrollable-content {
            scrollbar-color: #9ca3af #e5e7eb;
        }


        /* Drag and Drop Styles for Categories */
        .category-group {
            background-color: #f3f4f6; /* gray-100 */
            border-color: #e5e7eb; /* gray-200 */
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), background-color 0.3s ease-in-out, border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out; /* Bouncy transition */
            flex-shrink: 0; /* Prevent unwanted shrinking */
            box-sizing: border-box; /* Include padding/border in width calculation */
            margin-bottom: 1rem; /* Add some default bottom margin */
        }
        body.dark-theme .category-group {
            background-color: rgba(31, 41, 55, 0.5); /* gray-900/50 */
            border-color: #374151; /* gray-700 */
        }
        .category-group.dragging {
            opacity: 0.5;
            border: 2px dashed #6366f1; /* Indigo-500 */
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.6);
        }
        .category-group.drag-over {
            border: 2px solid #3b82f6; /* Blue-500 */
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }
        .drag-handle {
            color: #9ca3af; /* gray-400 */
            cursor: grab;
            touch-action: none; /* Prevent default touch actions like scrolling */
            transition: color 0.3s ease-in-out;
        }
        body.dark-theme .drag-handle {
            color: #9ca3af; /* gray-400 */
        }
        .drag-handle:hover {
            color: #4b5563; /* gray-600 */
        }
        body.dark-theme .drag-handle:hover {
            color: #d1d5db; /* gray-300 */
        }
        .drag-handle:active {
            cursor: grabbing;
        }


        /* Layout for categories in settings modal */
        #categories-form-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem; /* Consistent gap for flex items */
            align-items: flex-start; /* Align items to the top in rows */
        }
        .category-group.full-width-mode {
            width: 100%;
        }
        .category-group.stacked-two-modal,
        .category-group.stacked-three-modal {
            padding: 0.75rem 1rem; /* Smaller padding */
            display: flex; /* Use flexbox for internal layout */
            flex-direction: column; /* Stack content vertically */
            justify-content: space-between; /* Push header to top, add button to bottom */
        }
        .category-group.stacked-two-modal {
            width: calc(50% - 0.5rem); /* 1/2 width minus gap compensation */
        }
        .category-group.stacked-three-modal {
            width: calc(33.333% - 0.666rem); /* 1/3 width minus gap compensation */
        }
        .category-group.stacked-two-modal .flex.justify-between.items-center.mb-4,
        .category-group.stacked-three-modal .flex.justify-between.items-center.mb-4 {
            flex-shrink: 0; /* Prevent header from shrinking */
        }


        /* Main screen category containers */
        .main-category-row {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem; /* Tailwind gap-8 equivalent */
            margin-bottom: 3rem; /* Tailwind mb-12 equivalent */
        }
        .main-category-item {
            flex-shrink: 0;
            box-sizing: border-box;
        }
        .main-category-item.full-width {
            width: 100%;
        }
        .main-category-item.stacked-two {
            width: calc(50% - 1rem); /* 1/2 width minus gap compensation */
        }
        .main-category-item.stacked-three {
            width: calc(33.333% - 1.333rem); /* 1/3 width minus gap compensation */
        }


        /* Responsive Input Group within Modal */
        .class-input-group {
            background-color: #ffffff; /* white */
            border-color: #e5e7eb; /* gray-200 */
            transition: all 0.3s ease-in-out, background-color 0.3s ease-in-out, border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out; /* Animation for classes */
            display: flex; /* Use flexbox */
            flex-wrap: wrap; /* Allow items to wrap to the next line */
            gap: 0.75rem; /* Consistent gap between inputs */
            align-items: center; /* Align items vertically */
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid;
        }
        body.dark-theme .class-input-group {
            background-color: rgba(31, 41, 55, 0.5); /* gray-800/50 */
            border-color: #374151; /* gray-700 */
        }


        /* Make inputs take full width when wrapped, or distribute space */
        .class-input-group .class-title-input,
        .class-input-group .class-details-input,
        .class-input-group .class-url-input,
        .class-input-group .class-schedule-slot-select { /* Changed to select */
            flex-grow: 1; /* Allow inputs to grow */
            flex-basis: 150px; /* Minimum width before wrapping */
            min-width: 0; /* Allow shrinking below flex-basis if needed */
        }
        .class-input-group .flex.items-center.gap-2 { /* The URL input and remove button container */
            flex-grow: 1;
            flex-basis: 150px; /* Minimum width for this group */
            min-width: 0;
        }


        /* Ensure form inputs themselves handle overflow */
        .form-input, .form-select { /* Added form-select */
            width: 100%; /* Ensure inputs take full available width of their flex item */
            padding: 0.75rem;
            background-color: #f3f4f6; /* gray-100 */
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.5rem;
            color: #1f2937; /* gray-800 */
            transition: all 0.3s ease, background-color 0.3s ease-in-out, border-color 0.3s ease-in-out, color 0.3s ease-in-out;
            min-width: 0; /* Allow content to shrink */
            word-break: break-word; /* Break long words to prevent horizontal scroll */
        }
        body.dark-theme .form-input, body.dark-theme .form-select { /* Added form-select */
            background-color: #4b5563; /* gray-600 */
            border-color: #6b7280; /* gray-500 */
            color: #f9fafb; /* gray-50 */
        }
        .form-input:focus, .form-select:focus { /* Added form-select */
            outline: none;
            ring-width: 2px;
            ring-color: #4f46e5; /* indigo-600 */
            border-color: #4f46e5; /* indigo-600 */
            box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.5); /* Add focus shadow */
        }
        /* Drag and Drop Styles for Classes */
        .class-input-group.dragging {
            opacity: 0.5; /* No border or box-shadow for dragging item */
        }
        /* Removed .class-input-group.drag-over */
        /* Removed .class-inputs-container.drag-over-container */
        .class-inputs-container {
            min-height: 50px; /* Ensure visibility for empty containers */
            transition: all 0.2s ease-in-out;
        }
        /* Specific style for class drag handle */
        .drag-handle-class {
            color: #9ca3af; /* gray-400 */
            cursor: grab;
            touch-action: none; /* Prevent default touch actions like scrolling */
            transition: color 0.3s ease-in-out;
            padding: 0.25rem; /* Smaller padding for a sleeker look */
        }
        body.dark-theme .drag-handle-class {
            color: #9ca3af; /* gray-400 */
        }
        .drag-handle-class:hover {
            color: #4b5563; /* gray-600 */
        }
        body.dark-theme .drag-handle-class:hover {
            color: #d1d5db; /* gray-300 */
        }
        .drag-handle:active {
            cursor: grabbing;
        }
        .remove-class-btn, .duplicate-class-btn, .duplicate-category-btn {
            color: #9ca3af; /* gray-400 */
            transition: color 0.3s ease-in-out, transform 0.2s ease-in-out, background-color 0.2s ease-in-out;
            border-radius: 9999px; /* Make them round */
        }
        body.dark-theme .remove-class-btn, body.dark-theme .duplicate-class-btn, body.dark-theme .duplicate-category-btn {
            color: #9ca3af; /* gray-400 */
        }
        .remove-class-btn:hover {
            color: #ef4444; /* red-500 */
            background-color: rgba(239, 68, 68, 0.1); /* light red background */
            transform: scale(1.1);
        }
        .duplicate-class-btn:hover, .duplicate-category-btn:hover {
            color: #22c55e; /* green-500 */
            background-color: rgba(34, 197, 94, 0.1); /* light green background */
            transform: scale(1.1);
        }
        /* Styles for the new toggle buttons */
        .toggle-layout-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 1.75rem; /* Explicitly requested width */
            height: 1.0rem; /* Explicitly requested height */
            padding: 0.125rem 0.5rem; /* Adjusted padding to create pill shape with internal spacing */
            border-radius: 9999px; /* Ensures pill shape */
            color: white;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .toggle-layout-button.stacked {
            background-color: #3b82f6; /* blue-500 */
        }
        .toggle-layout-button.full-width {
            background-color: #9ca3af; /* gray-400 */
        }
        .toggle-layout-button:hover {
            transform: scale(1.05);
        }
        .toggle-layout-button.stacked:hover {
            background-color: #2563eb; /* blue-600 */
        }
        .toggle-layout-button.full-width:hover {
            background-color: #6b7280; /* gray-500 */
        }
        body.dark-theme .toggle-layout-button.stacked {
            background-color: #60a5fa; /* blue-400 */
        }
        body.dark-theme .toggle-layout-button.full-width {
            background-color: #4b5563; /* gray-600 */
        }
        body.dark-theme .toggle-layout-button.stacked:hover {
            background-color: #3b82f6; /* blue-500 */
        }
        body.dark-theme .toggle-layout-button.full-width:hover {
            background-color: #6b7280; /* gray-600 */
        }
        .toggle-layout-button svg {
            width: 0.75rem; /* Adjusted SVG size */
            height: 0.75rem;
            fill: currentColor;
        }
        #confirm-action-modal .confirm-button-red {
            background-color: #ef4444; /* red-500 */
        }
        #confirm-action-modal .confirm-button-red:hover {
            background-color: #dc2626; /* red-600 */
        }
        .confirm-action-button {
            background-color: #4f46e5; /* indigo-600 */
            transition: background-color 0.3s ease;
        }
        .confirm-action-button:hover {
            background-color: #4338ca; /* indigo-700 */
        }
        .confirm-action-button:disabled {
            background-color: #6366f1; /* indigo-500 */
            cursor: not-allowed;
            opacity: 0.5;
        }


        #loading-overlay {
            display: none; /* Initially hidden */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            color: white;
            flex-direction: column;
            gap: 1rem;
            transition: all 0.3s ease-in-out;
        }
        #loading-overlay p {
            font-size: 1.25rem;
            font-weight: 600;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #toast-container {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 50;
            display: flex;
            flex-direction: column-reverse;
            gap: 0.5rem;
        }


        .toast {
            background-color: #1f2937; /* gray-800 */
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            opacity: 0;
            transform: translateX(100%);
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }


        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }
    </style>
</head>
<body class="light-theme">
    <div class="p-8 md:p-12 main-container rounded-2xl md:mx-auto max-w-7xl relative mx-4 mt-8 shadow-2xl">
        <header class="flex justify-between items-start mb-6">
            <div>
                <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold tracking-tight mb-2">Pick A Class</h1>
                <h3 id="Time" class="text-xl md:text-2xl font-bold"></h3>
            </div>
            <div class="flex flex-col sm:flex-row gap-4">
                <button id="google-sign-in-button" class="flex items-center justify-center gap-2 p-3 text-white bg-indigo-600 rounded-full shadow-lg hover:bg-indigo-700 transition-all duration-300 transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12.24 10.232v3.526h6.14c-.25 1.558-1.556 3.615-4.526 3.615-2.738 0-4.97-2.197-4.97-4.915s2.232-4.915 4.97-4.915c1.47 0 2.476.623 3.045 1.173l2.84-2.753c-1.745-1.636-4.045-2.656-6.045-2.656C6.732 4.966 2.75 8.938 2.75 14s3.982 9.034 9.034 9.034c6.304 0 9.034-4.225 9.034-8.835 0-.606-.062-1.156-.16-1.666H12.24z"></path>
                    </svg>
                    <span>Sign In</span>
                </button>
                <button id="settings-button" class="p-3 text-white rounded-full shadow-lg transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.223 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </button>
            </div>
        </header>

        <main id="main-content">
            <!-- Classes will be dynamically injected here -->
            <p class="text-center text-gray-500 dark:text-gray-400">Loading your classes...</p>
        </main>

        <footer class="mt-8 text-center text-sm">
            <p class="text-gray-500 dark:text-gray-400">Â© 2024 Your App. All rights reserved.</p>
        </footer>
    </div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="modal-content w-full md:max-w-4xl p-6 md:p-8 rounded-lg shadow-xl relative m-4">
                <button id="close-settings-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-white transition-colors duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                <h3 class="text-2xl font-bold mb-6 text-gray-800 dark:text-white">Settings</h3>
                <div id="modal-scrollable-content" class="h-auto max-h-[80vh] overflow-y-auto pr-4">
                    <div class="mb-8">
                        <h4 class="text-xl font-bold mb-4">Display</h4>
                        <div class="flex justify-between items-center bg-gray-100 dark:bg-gray-700 p-4 rounded-lg shadow-inner">
                            <span class="font-medium text-gray-800 dark:text-gray-200">Dark Mode</span>
                            <button id="theme-toggle" class="relative inline-flex items-center h-6 rounded-full w-11 transition-colors">
                                <span class="sr-only">Toggle dark mode</span>
                                <span class="translate-x-1 inline-block w-4 h-4 transform bg-white rounded-full transition-transform"></span>
                            </button>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                            <span>Categories and Classes</span>
                            <!-- New buttons for layout modes, just for demonstration -->
                            <button id="toggle-layout-stacked-two" class="toggle-layout-button stacked">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/></svg>
                            </button>
                            <button id="toggle-layout-stacked-three" class="toggle-layout-button full-width">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/></svg>
                            </button>
                            <button id="toggle-layout-full-width" class="toggle-layout-button full-width">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/></svg>
                            </button>
                        </h4>
                        <div id="categories-form-container">
                            <!-- Categories will be dynamically injected here -->
                            <p class="text-center text-gray-500 dark:text-gray-400">No categories added yet.</p>
                        </div>
                        <button id="add-category-button" class="mt-4 w-full flex items-center justify-center p-3 text-white bg-indigo-600 rounded-lg shadow-lg hover:bg-indigo-700 transition-all duration-300 transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                            </svg>
                            <span class="ml-2">Add New Category</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Confirmation Modal -->
    <div id="confirm-action-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="modal-content w-full md:max-w-lg p-6 md:p-8 rounded-lg shadow-xl relative m-4">
                <div class="flex flex-col items-center justify-center text-center">
                    <svg id="confirm-icon" class="h-12 w-12 text-red-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    <h3 id="confirm-modal-title" class="text-2xl font-bold mb-2">Are you sure?</h3>
                    <p id="confirm-modal-body" class="text-gray-600 dark:text-gray-300 mb-4">This action cannot be undone.</p>
                    <div class="flex gap-4">
                        <button id="cancel-action-button" class="flex-1 p-3 font-semibold text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors duration-300">Cancel</button>
                        <button id="confirm-action-button" class="flex-1 p-3 font-semibold text-white bg-red-500 rounded-lg hover:bg-red-600 transition-colors duration-300">Confirm</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>Loading your data...</p>
    </div>


    <!-- Toast Container -->
    <div id="toast-container"></div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const googleSignInButton = document.getElementById('google-sign-in-button');
            
            // =========================================================================
            // ACTION REQUIRED: REPLACE THESE PLACEHOLDERS WITH YOUR OWN CREDENTIALS
            // To fix the 401 error, you need to create your own credentials in the
            // Google Cloud Console and paste them here.
            // =========================================================================
            const clientId = '229541691765-tff55vvpj334bt71rpm8jrg2g6hugdau.apps.googleusercontent.com'; // e.g., '1234567890-abcdefg1234567890.apps.googleusercontent.com'
            const redirectUri = 'https://codebeautify.org/htmlviewer'; // e.g., 'https://your-domain.com/redirector.html'
            // =========================================================================
            
            const scope = 'https://www.googleapis.com/auth/calendar.events';
            const authUrl = 'https://accounts.google.com/o/oauth2/v2/auth';


            // Event listener for the Google Sign-in button
            googleSignInButton.addEventListener('click', () => {
                const authParams = new URLSearchParams({
                    client_id: clientId,
                    redirect_uri: redirectUri,
                    response_type: 'token',
                    scope: scope,
                    prompt: 'select_account'
                });
                window.location.href = `${authUrl}?${authParams.toString()}`;
            });


            // The rest of your existing JavaScript for the application.
            const mainContent = document.getElementById('main-content');
            const settingsModal = document.getElementById('settings-modal');
            const openSettingsButton = document.getElementById('settings-button');
            const closeSettingsButton = document.getElementById('close-settings-modal');
            const themeToggle = document.getElementById('theme-toggle');
            const body = document.body;
            const categoriesFormContainer = document.getElementById('categories-form-container');
            const addCategoryButton = document.getElementById('add-category-button');
            const confirmModal = document.getElementById('confirm-action-modal');
            const confirmButton = document.getElementById('confirm-action-button');
            const cancelButton = document.getElementById('cancel-action-button');
            const confirmTitle = document.getElementById('confirm-modal-title');
            const confirmBody = document.getElementById('confirm-modal-body');
            const toastContainer = document.getElementById('toast-container');
            const timeDisplay = document.getElementById('Time');


            // Placeholder data structure for categories and classes
            let data = {
                layoutMode: 'stacked-two', // 'full-width', 'stacked-two', 'stacked-three'
                categories: [
                    // Example category
                    // {
                    //     id: 'category-1',
                    //     title: 'Period 1',
                    //     classes: [
                    //         { id: 'class-1', title: 'Math', details: 'Algebra II', url: 'https://classroom.google.com/c/123456' },
                    //         { id: 'class-2', title: 'Science', details: 'Chemistry', url: 'https://classroom.google.com/c/789012' }
                    //     ]
                    // }
                ]
            };


            let pendingActionCallback = null;
            let draggedElement = null;
            let currentDragContainer = null;
            let dragOriginCategory = null;
            let dragOverCategory = null;
            let initialMouseX = 0;
            let initialMouseY = 0;
            let lastMouseX = 0;
            let lastMouseY = 0;
            let activeDropTargets = null;


            const showToast = (message, duration = 3000) => {
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.textContent = message;
                toastContainer.appendChild(toast);
                // Force reflow to enable transition
                void toast.offsetWidth;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 500); // Remove after transition
                }, duration);
            };


            const showConfirmationModal = (title, bodyText, confirmButtonText, confirmButtonClass, onConfirm) => {
                confirmTitle.textContent = title;
                confirmBody.textContent = bodyText;
                confirmButton.textContent = confirmButtonText;
                confirmButton.className = 'flex-1 p-3 font-semibold text-white rounded-lg transition-colors duration-300 ' + confirmButtonClass;
                confirmModal.classList.remove('hidden');


                pendingActionCallback = onConfirm;
            };


            const closeConfirmationModal = () => {
                confirmModal.classList.add('hidden');
                pendingActionCallback = null;
            };


            confirmButton.addEventListener('click', () => {
                if (pendingActionCallback) {
                    pendingActionCallback();
                }
                closeConfirmationModal();
            });


            cancelButton.addEventListener('click', closeConfirmationModal);
            confirmModal.addEventListener('click', (e) => {
                if (e.target === confirmModal) {
                    closeConfirmationModal();
                }
            });


            // Function to generate the HTML for a class card
            const createClassCard = (classData) => {
                const classCard = document.createElement('div');
                classCard.className = `class-card relative flex flex-col p-6 rounded-xl border-2 mb-4 w-full h-44 overflow-hidden shadow-md transform-gpu`;
                classCard.innerHTML = `
                    <button class="new-tab-button" aria-label="Open in new tab">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z" />
                            <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z" />
                        </svg>
                    </button>
                    <h4 class="text-xl font-bold mb-1">${classData.title}</h4>
                    <p class="text-sm font-medium mb-3">${classData.details}</p>
                    <a href="${classData.url}" target="_blank" class="mt-auto self-start text-indigo-600 dark:text-indigo-400 font-semibold hover:underline">Go to Class</a>
                `;
                classCard.addEventListener('click', (e) => {
                    // Check if the click was on the button to prevent double-opening
                    if (e.target.closest('.new-tab-button')) {
                        return;
                    }
                    window.open(classData.url, '_blank');
                });
                return classCard;
            };


            // Function to render all categories and classes
            const renderCategories = () => {
                mainContent.innerHTML = ''; // Clear previous content
                if (data.categories.length === 0) {
                    mainContent.innerHTML = `<p class="text-center text-gray-500 dark:text-gray-400 p-8">Looks like you haven't added any classes yet! Click the settings gear to get started.</p>`;
                    return;
                }
                data.categories.forEach(category => {
                    const categoryContainer = document.createElement('div');
                    categoryContainer.className = `main-category-item flex-1 ${data.layoutMode === 'stacked-two' ? 'stacked-two' : data.layoutMode === 'stacked-three' ? 'stacked-three' : 'full-width'}`;
                    
                    const header = document.createElement('h2');
                    header.className = 'text-2xl font-bold mb-4';
                    header.textContent = category.title;
                    categoryContainer.appendChild(header);


                    const classGrid = document.createElement('div');
                    classGrid.className = 'grid sm:grid-cols-1 lg:grid-cols-2 gap-4';
                    
                    category.classes.forEach(classData => {
                        classGrid.appendChild(createClassCard(classData));
                    });
                    
                    categoryContainer.appendChild(classGrid);
                    mainContent.appendChild(categoryContainer);
                });
            };


            // Function to generate the HTML for a category in the settings modal
            const createCategoryForm = (category) => {
                const categoryGroup = document.createElement('div');
                categoryGroup.className = `category-group rounded-lg border p-4 shadow-md overflow-hidden ${data.layoutMode === 'full-width' ? 'full-width-mode' : data.layoutMode === 'stacked-two' ? 'stacked-two-modal' : 'stacked-three-modal'}`;
                categoryGroup.dataset.id = category.id;
                categoryGroup.setAttribute('draggable', 'true');
                
                categoryGroup.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-2 drag-handle-category cursor-grab">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                            <input type="text" class="category-title form-input font-bold" value="${category.title}" placeholder="Category Title">
                        </div>
                        <div class="flex gap-2">
                            <button class="duplicate-category-btn p-1 transition-colors duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v4a1 1 0 001 1h4a1 1 0 001-1V7m-4 5h-1V3a1 1 0 011-1h6a1 1 0 011 1v12a1 1 0 01-1 1H8a1 1 0 01-1-1v-4m-1-4h14a1 1 0 011 1v12a1 1 0 01-1 1H7a1 1 0 01-1-1V6a1 1 0 011-1z" />
                                </svg>
                            </button>
                            <button class="remove-category-btn p-1 transition-colors duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="class-inputs-container flex flex-col gap-3 min-h-[50px]">
                        <!-- Classes will be dynamically injected here -->
                    </div>
                    <button class="add-class-button w-full flex items-center justify-center p-2 text-white bg-indigo-600 rounded-lg shadow-lg hover:bg-indigo-700 transition-all duration-300 transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 mt-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                    </button>
                `;


                const classInputsContainer = categoryGroup.querySelector('.class-inputs-container');
                category.classes.forEach(cls => {
                    classInputsContainer.appendChild(createClassInput(cls, category.id));
                });


                const removeCategoryButton = categoryGroup.querySelector('.remove-category-btn');
                removeCategoryButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showConfirmationModal('Delete Category', 'Are you sure you want to delete this category and all its classes? This action cannot be undone.', 'Delete', 'confirm-button-red', () => {
                        removeCategory(category.id);
                    });
                });


                const addClassButton = categoryGroup.querySelector('.add-class-button');
                addClassButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    addNewClass(category.id);
                });


                const categoryTitleInput = categoryGroup.querySelector('.category-title');
                categoryTitleInput.addEventListener('input', (e) => {
                    updateCategoryTitle(category.id, e.target.value);
                });
                
                // Add event listeners for dragging
                categoryGroup.addEventListener('dragstart', handleDragStart);
                categoryGroup.addEventListener('dragenter', handleDragEnter);
                categoryGroup.addEventListener('dragover', handleDragOver);
                categoryGroup.addEventListener('dragleave', handleDragLeave);
                categoryGroup.addEventListener('drop', handleDrop);
                categoryGroup.addEventListener('dragend', handleDragEnd);


                return categoryGroup;
            };


            // Function to render all categories in the settings modal
            const renderCategoryForms = () => {
                categoriesFormContainer.innerHTML = '';
                if (data.categories.length === 0) {
                    categoriesFormContainer.innerHTML = `<p class="text-center w-full text-gray-500 dark:text-gray-400 p-8">No categories added yet.</p>`;
                    return;
                }
                data.categories.forEach(category => {
                    categoriesFormContainer.appendChild(createCategoryForm(category));
                });
            };


            // Function to generate the HTML for a class input in the settings modal
            const createClassInput = (classData, categoryId) => {
                const classInputGroup = document.createElement('div');
                classInputGroup.className = 'class-input-group';
                classInputGroup.dataset.id = classData.id;
                classInputGroup.setAttribute('draggable', 'true');


                classInputGroup.innerHTML = `
                    <div class="drag-handle-class cursor-grab">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </div>
                    <input type="text" class="class-title-input form-input" value="${classData.title}" placeholder="Class Title">
                    <input type="text" class="class-details-input form-input" value="${classData.details}" placeholder="Details (e.g., 'Period 1')">
                    <div class="flex items-center gap-2 flex-grow">
                        <input type="url" class="class-url-input form-input" value="${classData.url}" placeholder="URL (e.g., Google Classroom link)">
                        <button class="remove-class-btn p-1 transition-colors duration-300" aria-label="Remove class">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>
                `;


                const removeButton = classInputGroup.querySelector('.remove-class-btn');
                removeButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showConfirmationModal('Delete Class', 'Are you sure you want to delete this class? This action cannot be undone.', 'Delete', 'confirm-button-red', () => {
                        removeClass(categoryId, classData.id);
                    });
                });


                const titleInput = classInputGroup.querySelector('.class-title-input');
                titleInput.addEventListener('input', (e) => {
                    updateClassData(categoryId, classData.id, 'title', e.target.value);
                });


                const detailsInput = classInputGroup.querySelector('.class-details-input');
                detailsInput.addEventListener('input', (e) => {
                    updateClassData(categoryId, classData.id, 'details', e.target.value);
                });


                const urlInput = classInputGroup.querySelector('.class-url-input');
                urlInput.addEventListener('input', (e) => {
                    updateClassData(categoryId, classData.id, 'url', e.target.value);
                });
                
                // Add event listeners for dragging
                classInputGroup.addEventListener('dragstart', handleDragStart);
                classInputGroup.addEventListener('dragenter', handleDragEnter);
                classInputGroup.addEventListener('dragover', handleDragOver);
                classInputGroup.addEventListener('dragleave', handleDragLeave);
                classInputGroup.addEventListener('drop', handleDrop);
                classInputGroup.addEventListener('dragend', handleDragEnd);


                return classInputGroup;
            };


            const addNewCategory = () => {
                const newCategory = {
                    id: crypto.randomUUID(),
                    title: 'New Category',
                    classes: []
                };
                data.categories.push(newCategory);
                renderCategoryForms();
                renderCategories();
                showToast('New category added!');
            };


            const removeCategory = (categoryId) => {
                data.categories = data.categories.filter(c => c.id !== categoryId);
                renderCategoryForms();
                renderCategories();
                showToast('Category deleted successfully!');
            };


            const updateCategoryTitle = (categoryId, newTitle) => {
                const category = data.categories.find(c => c.id === categoryId);
                if (category) {
                    category.title = newTitle;
                    renderCategories(); // Update main view
                }
            };


            const addNewClass = (categoryId) => {
                const category = data.categories.find(c => c.id === categoryId);
                if (category) {
                    const newClass = {
                        id: crypto.randomUUID(),
                        title: 'New Class',
                        details: '',
                        url: ''
                    };
                    category.classes.push(newClass);
                    const classInputsContainer = categoriesFormContainer.querySelector(`.category-group[data-id="${categoryId}"] .class-inputs-container`);
                    classInputsContainer.appendChild(createClassInput(newClass, categoryId));
                    renderCategories(); // Update main view
                    showToast('New class added!');
                }
            };


            const removeClass = (categoryId, classId) => {
                const category = data.categories.find(c => c.id === categoryId);
                if (category) {
                    category.classes = category.classes.filter(cls => cls.id !== classId);
                    renderCategoryForms();
                    renderCategories();
                    showToast('Class deleted successfully!');
                }
            };


            const updateClassData = (categoryId, classId, field, value) => {
                const category = data.categories.find(c => c.id === categoryId);
                if (category) {
                    const classToUpdate = category.classes.find(cls => cls.id === classId);
                    if (classToUpdate) {
                        classToUpdate[field] = value;
                        renderCategories(); // Update main view
                    }
                }
            };


            // Function to handle the drag-and-drop logic for categories and classes.
            const handleDragStart = (e) => {
                const target = e.target.closest('.category-group, .class-input-group');
                if (!target) return;


                draggedElement = target;
                e.dataTransfer.setData('text/plain', target.dataset.id);
                e.dataTransfer.effectAllowed = 'move';
                setTimeout(() => target.classList.add('dragging'), 0); // Add class after a moment
                
                // Identify if we're dragging a category or a class
                if (target.classList.contains('category-group')) {
                    activeDropTargets = document.querySelectorAll('.category-group');
                } else if (target.classList.contains('class-input-group')) {
                    const parentCategory = target.closest('.category-group');
                    dragOriginCategory = parentCategory;
                    activeDropTargets = document.querySelectorAll(`.category-group[data-id="${parentCategory.dataset.id}"] .class-input-group`);
                    
                    // Also make other category containers droppable
                    const otherContainers = document.querySelectorAll('.category-group');
                    otherContainers.forEach(container => {
                        if (container !== parentCategory) {
                            container.classList.add('drag-over-container');
                        }
                    });
                }
            };


            const handleDragOver = (e) => {
                e.preventDefault(); // Necessary to allow dropping
                const target = e.target.closest('.category-group, .class-input-group, .class-inputs-container');
                if (!target || target === draggedElement) return;


                // Handle category dragging
                if (draggedElement.classList.contains('category-group') && target.classList.contains('category-group')) {
                    const dropTargetCategory = target;
                    if (draggedElement.dataset.id !== dropTargetCategory.dataset.id) {
                        const allCategories = Array.from(document.querySelectorAll('.category-group'));
                        const draggedIndex = allCategories.indexOf(draggedElement);
                        const targetIndex = allCategories.indexOf(dropTargetCategory);
                        
                        if (draggedIndex > targetIndex) {
                            categoriesFormContainer.insertBefore(draggedElement, dropTargetCategory);
                        } else {
                            categoriesFormContainer.insertBefore(draggedElement, dropTargetCategory.nextSibling);
                        }
                    }
                }
                
                // Handle class dragging
                if (draggedElement.classList.contains('class-input-group')) {
                    const dropTargetCategoryEl = target.closest('.category-group');
                    
                    if (dropTargetCategoryEl) {
                        dragOverCategory = dropTargetCategoryEl;
                        const classInputsContainer = dropTargetCategoryEl.querySelector('.class-inputs-container');
                        
                        // Check if we are dragging a class over another class
                        if (target.classList.contains('class-input-group')) {
                            const dropTargetClass = target;
                            const allClassesInContainer = Array.from(classInputsContainer.children);
                            const draggedIndex = allClassesInContainer.indexOf(draggedElement);
                            const targetIndex = allClassesInContainer.indexOf(dropTargetClass);
                            
                            if (draggedIndex > targetIndex) {
                                classInputsContainer.insertBefore(draggedElement, dropTargetClass);
                            } else {
                                classInputsContainer.insertBefore(draggedElement, dropTargetClass.nextSibling);
                            }
                        } else if (target.classList.contains('class-inputs-container') && target.children.length === 0) {
                             // Dragging into an empty class container
                            classInputsContainer.appendChild(draggedElement);
                        }
                    }
                }
            };


            const handleDragLeave = (e) => {
                const target = e.target.closest('.category-group, .class-input-group');
                if (target) {
                    target.classList.remove('drag-over');
                }
            };


            const handleDrop = (e) => {
                e.preventDefault();
                // We've already handled the DOM manipulation in dragover, so we just need to update our data model.
                if (draggedElement.classList.contains('category-group')) {
                    const updatedCategories = Array.from(categoriesFormContainer.children).map(el => {
                        const category = data.categories.find(c => c.id === el.dataset.id);
                        return category;
                    });
                    data.categories = updatedCategories;
                } else if (draggedElement.classList.contains('class-input-group')) {
                    // Update data model for class drag-and-drop
                    const classId = draggedElement.dataset.id;
                    const oldCategoryId = dragOriginCategory.dataset.id;
                    const newCategoryId = dragOverCategory ? dragOverCategory.dataset.id : oldCategoryId;

                    if (oldCategoryId !== newCategoryId) {
                        const oldCategory = data.categories.find(c => c.id === oldCategoryId);
                        const newCategory = data.categories.find(c => c.id === newCategoryId);
                        const classToMove = oldCategory.classes.find(c => c.id === classId);
                        
                        if (oldCategory && newCategory && classToMove) {
                            oldCategory.classes = oldCategory.classes.filter(c => c.id !== classId);
                            newCategory.classes.push(classToMove);
                        }
                    }

                    // Reorder classes within the new category
                    const newCategoryEl = categoriesFormContainer.querySelector(`.category-group[data-id="${newCategoryId}"]`);
                    const classInputsContainer = newCategoryEl.querySelector('.class-inputs-container');
                    const updatedClassesInNewCategory = Array.from(classInputsContainer.children).map(el => {
                        const category = data.categories.find(c => c.id === newCategoryId);
                        return category.classes.find(cls => cls.id === el.dataset.id);
                    });
                    
                    const newCategoryData = data.categories.find(c => c.id === newCategoryId);
                    newCategoryData.classes = updatedClassesInNewCategory;
                }
                
                renderCategories(); // Re-render the main view
            };


            const handleDragEnd = () => {
                if (draggedElement) {
                    draggedElement.classList.remove('dragging');
                }
                draggedElement = null;
                dragOriginCategory = null;
                dragOverCategory = null;
                activeDropTargets = null;
                
                // Clean up drag-over classes
                document.querySelectorAll('.category-group').forEach(el => el.classList.remove('drag-over-container'));
            };


            // Event listener for adding a new category
            addCategoryButton.addEventListener('click', addNewCategory);


            // Event listeners for the modal
            openSettingsButton.addEventListener('click', () => {
                settingsModal.classList.remove('hidden');
                renderCategoryForms();
            });
            closeSettingsButton.addEventListener('click', () => {
                settingsModal.classList.add('hidden');
            });
            settingsModal.addEventListener('click', (e) => {
                if (e.target === settingsModal) {
                    settingsModal.classList.add('hidden');
                }
            });


            // Function to toggle dark mode
            const toggleDarkMode = () => {
                if (body.classList.contains('light-theme')) {
                    body.classList.remove('light-theme');
                    body.classList.add('dark-theme');
                    themeToggle.style.backgroundColor = '#e5e7eb'; // gray-200
                    themeToggle.querySelector('span').style.transform = 'translateX(1.5rem)';
                } else {
                    body.classList.remove('dark-theme');
                    body.classList.add('light-theme');
                    themeToggle.style.backgroundColor = '#4b5563'; // gray-700
                    themeToggle.querySelector('span').style.transform = 'translateX(0.25rem)';
                }
            };
            themeToggle.addEventListener('click', toggleDarkMode);
            
            // Initial render
            renderCategories();
            
            // Clock function
            const updateTime = () => {
                const now = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric', second:
                'numeric' };
                timeDisplay.textContent = now.toLocaleDateString('en-US', options);
            };


            setInterval(updateTime, 1000);
            updateTime();
        });
    </script>
</body>
</html>
